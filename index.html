<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Narrative Visualization</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>  
  </head>
  <body onload="init()">
    <div>sup</div>
    <svg id="my_car" width=300 height=300></svg>
    <svg id="fuel_eff" width=300 height=300></svg>
    <div id="my_dataviz"></div>
    <script>
      function init () {
        load_fuel_eff()
        load_flower()
        load_my_car()
      }
      async function load_fuel_eff() {
        let data = await d3.csv("https://flunky.github.io/cars2017.csv")
        let margin = 50
        let width = 200
        let height = 200
        let x = d3.scaleLog().domain([10, 150]).range([0, width])
        let y = d3.scaleLog().domain([10, 150]).range([height, 0])
        
        d3.select("#fuel_eff").append("g")
        .attr("transform", `translate(${margin},${margin})`)
        .selectAll("circle").data(data).enter().append("circle")
        .attr("cx",function(d, i){return x(d.AverageCityMPG)})
        .attr("cy",function(d, i){return y(d.AverageHighwayMPG)})
        .attr("r",function(d, i){return Number(d.EngineCylinders) + 2})

        d3.select("#fuel_eff").append("g")
        .attr("transform",`translate(${margin},${margin})`)
        .call(d3.axisLeft(y).tickValues([10,20,50,100]).tickFormat(d3.format("~s")))

        d3.select("#fuel_eff").append("g")
        .attr("transform",`translate(${margin},${height+margin})`)
        .call(d3.axisBottom(x).tickValues([10,20,50,100]).tickFormat(d3.format("~s")))
      }
      async function load_flower() {
        // set the dimensions and margins of the graph
        var margin = {top: 10, right: 30, bottom: 40, left: 50},
            width = 520 - margin.left - margin.right,
            height = 520 - margin.top - margin.bottom;
        
        // append the svg object to the body of the page
        var Svg = d3.select("#my_dataviz")
          .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("transform",
                  "translate(" + margin.left + "," + margin.top + ")")
        
        
        
        //Read the data
        let data = await d3.csv("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/iris.csv")
      
        // Add X axis
        var x = d3.scaleLinear()
          .domain([4*0.95, 8*1.001])
          .range([ 0, width ])
        Svg.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x).tickSize(-height*1.3).ticks(10))
          .select(".domain").remove()
      
        // Add Y axis
        var y = d3.scaleLinear()
          .domain([-0.001, 9*1.01])
          .range([ height, 0])
          .nice()
        Svg.append("g")
          .call(d3.axisLeft(y).tickSize(-width*1.3).ticks(7))
          .select(".domain").remove()
      
        // Customization
        Svg.selectAll(".tick line").attr("stroke", "#EBEBEB")
      
        // Add X axis label:
        Svg.append("text")
            .attr("text-anchor", "end")
            .attr("x", width)
            .attr("y", height + margin.top + 20)
            .text("Sepal Length");
      
        // Y axis label:
        Svg.append("text")
            .attr("text-anchor", "end")
            .attr("transform", "rotate(-90)")
            .attr("y", -margin.left+20)
            .attr("x", -margin.top)
            .text("Petal Length")
      
        // Color scale: give me a specie name, I return a color
        var color = d3.scaleOrdinal()
          .domain(["setosa", "versicolor", "virginica" ])
          .range([ "#402D54", "#D18975", "#8FD175"])
      
        // Add dots
        Svg.append('g')
          .selectAll("dot")
          .data(data)
          .enter()
          .append("circle")
            .attr("cx", function (d) { return x(d.Sepal_Length); } )
            .attr("cy", function (d) { return y(d.Petal_Length); } )
            .attr("r", 5)
            .style("fill", function (d) { return color(d.Species) } )
      }
      async function load_my_car() {
        let data = await d3.csv("my_auto_mpg.csv")
        let margin = 50
        let width = 200
        let height = 200
        let x = d3.scaleLinear().domain([0, 250]).range([0, width])
        let y = d3.scaleLinear().domain([0, 60]).range([height, 0])
        
        d3.select("#my_car").append("g")
        .attr("transform", `translate(${margin},${margin})`)
        .selectAll("circle").data(data).enter().append("circle")
        .attr("cx",function(d, i){return x(d.horsepower)})
        .attr("cy",function(d, i){return y(d.mpg)})
        .attr("r",function(d, i){return Number(d.cylinders) + 2})

        d3.select("#my_car").append("g")
        .attr("transform",`translate(${margin},${margin})`)
        .call(d3.axisLeft(y))//.tickValues([10,20,50,100]).tickFormat(d3.format("~s")))

        d3.select("#my_car").append("g")
        .attr("transform",`translate(${margin},${height+margin})`)
        .call(d3.axisBottom(x))//.tickValues([10,20,50,100]).tickFormat(d3.format("~s")))
      }
    </script>
  </body>
</html>